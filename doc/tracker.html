<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!-- always required -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<!-- needed for sequence diagrams -->
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/raphael-min.js'></script>
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/underscore-min.js'></script>
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/sequence-diagram-min.js'></script>
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/sequence-diagram-wrapper.js'></script>

<!-- needed for includes -->
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/clientInclude.js'></script>

<!-- needed for table of contents -->
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/tocify.js'></script>

<link rel="stylesheet" href="//normalize-css.googlecode.com/svn/trunk/normalize.css" />

<!-- always required -->
<link rel='stylesheet' href='http://talentappstore.github.io/tas-des-static/css/des.css' type='text/css' media='all' />

<title>Source tracking</title>
</head>
<body>

<div id="toc"></div>

<h1>Overview</h1>

<p>The source tracking APIs (/trackers) defined by TAS are for a source tracking system that supports fractional attribution.</p>

<h2>Fractional attribution</h2>
 
<p>The source tracking provided by most ATSs only tracks the last click that led the candidate to apply for the job. However last click
tracking only provides a small subset of the true picture of what led a candidate to a specific job.</p>

<p>The TAS source tracking APIs support fractional attribution, where an end result (such as someone applying for a job) can be mapped back to
a whole chain of user interactions such as social sharing, emailing links, etc.</p>

<h1>Scenarios</h1>

<h2>Scenario #1 - a legacy ATS uses tracker to pass through legacy source tracking information</h2>

<h3>A candidate arrives at the job details page on the legacy ATS with some legacy information in the "source" url parameter</h3>

<p>A candidate arrives at:

<div class='codeBlock'>
acme/legacyats.com/jobs/Creative-Director-GR4022?source=print-media-smh
</div>
</p>

<p>The legacy ATS knows it will be handing off the apply process to some other microservices.</p>

<p>While the apply process is out of legacyats's control, it can rely on the fact that a tracker will be passed
back in the request of the POST /candidates call for any completed job application.
</p>

<p>Therefore the legacy ATS needs to pack its legacy detail into a tracker, and pass that tracker in to the
apply process.</p>

<div class='codeBlock'>
POST /trackers/acme/legacysoft/ats
<div class='clientInclude' data-href='../examples/tracker-createLegacySourceTracker.json'></div>
Response:
Location: 16044
</div>
</p>

<h3>Candidate clicks to apply at the simpleapply microservice</h3>

<p>A deep link like this leads to simpleapply:

<div class='codeBlock'>
acme.simpleapply.com/jobs/42033?tracker=16044
</div>
</p>
 
<p>As previously, a session tracker (16045) is now created by simpleapply and chained to the existing tracker.
</p>

<p>Once the candidate has completed the application, simpleapply passes that tracker (16045) into the
POST /candidates API call.
</p>

<h3>The legacy ATS produces the API POST /candidates.</h3>

<p>It receives the incoming job application and pulls out the legacy details held in the tracker.
</p>

<p>legacyats does not know who "packed" the legacy data.
</p>

<p>In this example, it was the ATS itself. But
it could also have been some other microsite app or similar that embedded the apply button.
</p>

<p>So legacyats queries for the first (ascending up the chain) tracker of kind==Campaign, and campaignKind==User defined,
and with a value for legacyats-source (no matter which app created it).

<div class='codeBlock'>
GET /trackers/16045/chain
Response:
<div class='clientInclude' data-href='../examples/trackers-legacyATS.json'></div>
</div>
</p>

<p>legacyats iterates through all the trackers and eventually reaches the one with a legacyats-source value.
legacyats has now successfully passed its own data through the apply process using trackers.
</p>

<h2>Scenario #2a - a job is advertised in a print publication. Someone searches by code at the careers site and then applies. 
</h2>

<h2>Scenario #3 - a job is emailed to a candidate who shares it with another candidate</h2>

<h3>An automated alert for a new job is emailed to a candidate</h3>

<p>A base tracker is obtained by the mailout app:

<div class='codeBlock'>
POST /trackers/acme/tas/mailoutResponse:
<div class='clientInclude' data-href='../examples/tracker-createMailoutTracker.json'></div>
Response:
Location: 9022
</div>
</p>

<p>The outgoing email has a link like this:
<div class='codeBlock'>
&lt;a href="/jobs/1004532?tracker=9022&gt;Creative director&lt;/a&gt;
</div>
</p>

<h3>That candidate visits the careers site app to view the job</h3>

<p>The careers site uses the standard tracker session filtering on GET /jobs/{}

<div class='codeBlock'>
HttpSession session = httpRequest.getSession(false);
if (session == null) {
	// create session, and accompanying session tracker
	session = httpRequest.getSession(true);
	int trackerID;
	String request =
	{
		"kind": "sessionCreation",
		"ip": httpRequest.getIP(),
		"Accept-Language": httpRequest..,
		"userAgent": httpRequest..
	}
	Integer trackerID = httpRequest.getParms("tracker");
	if (trackerID != null) {
		// we are chaining to an incoming tracker
		POST /trackers/9022/trackers/acme/tas/careersite
		Request: <- request
		Location: -> trackerID
	} else
	{
		// no incoming tracker to chain to
		POST /trackers/acme/tas/careersite
		Request: <- request
		Location: -> trackerID
	}
	session.setAttribute("tracker", trackerID); // 9023 in this example

	// from here on, we will add (or replace) the tracker parm on all links we emit, e.g. "?tracker=9023" 
	// one tiny problem is that the current URL (i.e. this entry page) has the original (if any) tracker param on it.
	// That creates a problem in that if this page contained a social sharing plugin, this new session tracker would not be seen by it. The solution is
	// to try and force navigation to any new page as quickly as possible - the new page's links will contain the proper tracker param.
}
</div>
</p>

<h3>Not interested themselves, they click to share the job details page on Facebook</h3>

<p>The careers site may force navigation to a new page, so that any sharing plugins which rely on current URL have
access to the up to date session tracker (see comments above).
</p>

<p>One way is to hide the sharing plugins when the job details page is being generated for a new session, and instead
show a button "Enable sharing" that just navigates to the current page - after navigation the page will not be being
generated for a new session, so the sharing plugins will show as they should.
</p>

<h3>The candidate uses Facebook share button which shares the current URL</h3>

<h3>A friend sees their Facebook post and clicks through to view the job</h3>

<p>The friend clicks through to the target page at /jobs/1004532?tracker=9023.
</p>

<p>The same logic as above fires, and because the friend does not have a session, the careersite app
creates a new one, along with a visit tracker (9024), and attaches it to all links it emits (since it is a strong tracking app).
</p>
  
<h3>The friend is not interested in that job, but while browsing the careers site they find another job they are interested in</h3>

<p>This job is at /jobs/26?tracker=9024
</p>
	
<h3>Leaving for work, they do not have time to apply, so they share the link with themselves via email</h3>

<p>they use sharing via email to send the link to themselves</p>
	
<h3>On their way to work on the bus, they open the email and return to the careers site on their mobile phone</h3>

<p>they click through to the target page at /jobs/26?tracker=9024
</p>

<p>the same logic as above fires, and because there is no session for their mobile phone, a new one, along with
a visit tracker (9025) is created and used for all links.
</p>  

<h3>They complete an application for the job</h3>

<ul>
<li>the tenant has set up simpleapply to handle job applications
<li>the candidate goes to acme.simpleapply.com/jobs/26?tracker=9024
<li>simpleapply does not attach session creation events to the tracker (has no tracker filter)
<li>simpleapply passes the application to the ATS, along with tracker=9024
</ul>

<h2>Scenario #4 - a job is shared via employee referral to a candidate who applies</h2>

<h3>The employee referral system (refly) has a list of open jobs along with their apply links (via GET /jobs API)</h3>

<p>refly creates a new base tracker that will hold its own specific details, in this case that
referral has been made by Fred.
</p>

<div class='codeBlock'>
POST /trackers/acme/tas/mailoutResponse:
<div class='clientInclude' data-href='../examples/tracker-createEmployeeReferralTracker.json'></div>
Response:
Location: 9041
</div>
</p>

<p>refly now facilitates getting that link in front of candidate(s):

<div class='codeBlock'>
&lt;a href="/jobs/1004532?tracker=9041&gt;
</div>

<h3>The candidate clicks on the link and arrives at the careers site</h3>

<p>As previously, a new session and associated visit tracker (9046) is created by the careers site and chained to the
existing tracker.
</p>

<div class='codeBlock'>
POST /trackers/9041/trackers/acme/tas/careersite
Request
.. create session tracker
Response:
Location: 9046
</div>
</p>
	
<h3>The candidate applies at simpleapply</h3>

<p>The tracker is passed into POST /candidates with the job application.
</p>

<p>The ATS producing POST /candidates now notifies the agent insight app that some change
has happened to an application (i.e. creation in this case):

<div class='codeBlock'>
POST /applications/66022/deltaPings
</div>
</p>

<p>agent insight gets the application's tracker 
<div class='codeBlock'>
GET /applications/66022/tracker
Response:
Location: 9046
</div>
</p>

<p>agent insight now asks for every installed app that had some part in sourcing this application - i.e. that
created a tracker upstream from 9046

<div class='codeBlock'>
GET /trackers/9046/chain
Response:
<div class='clientInclude' data-href='../examples/trackers-simple.json'></div>
</div>
</p>

<p>agent insight now uses the list of sourcing apps to alert each of the tracker owners
that an application they have sourced has changed. Theoretically a sourcing app may appear
multiple times in the chain:

<div class='codeBlock'>
POST /applications/bySourcingApp/acme/supersoft/refly/66022/deltaPings
{
	"operation": "insert",
	"trackers": [ 9041 ]
}
</div>

<p>refly asks for specific information about the application. Agent insight internally re-creates the chain of trackers and
verifies that refly is allowed to ask for this application before responding

<div class='codeBlock'>
GET /applications/bySourcingApp/acme/supersoft/refly/66022/sourcerDetails
Response:
{
	"sourcerBucket": "interview",
	"trackers": [ 9041 ]
}
</div>
</p>

<p>refly now has all the information it needs about the application that it had a part in sourcing
</p>



<script>
$(document).ready(function() {

	renderSequenceDiagrams();
	renderClientIncludes();
	renderTOC();
});
</script>


</body>
</html>