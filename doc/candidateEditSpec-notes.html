<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!-- always required -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<!-- needed for sequence diagrams -->
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/raphael-min.js'></script>
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/underscore-min.js'></script>
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/sequence-diagram-min.js'></script>
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/sequence-diagram-wrapper.js'></script>

<!-- needed for includes -->
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/clientInclude.js'></script>

<!-- needed for table of contents -->
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/tocify.js'></script>

<!-- always required -->
<link rel='stylesheet' href='http://talentappstore.github.io/tas-des-static/css/des.css' type='text/css' media='all' />


<title>Design notes on candidateEditSpec and candidateEdit</title>
</head>
<body>

<h1>candidateEditSpec</h1>

<div id="toc"></div>

<h1>message</h1>
The message contains a text message (possibly including links), and a message type, intended for showing to the candidate.
The message may be used, for example, to explain to the candidate why their desired profile was amended, or denied. For example:
<ul>
<li>"You cannot apply for this req from a mobile phone - please use a desktop"
<li>"As a resident of Russia, you cannot apply for our jobs due to your country's data sovereignty laws"
</ul>

<h1>amendedIntent</h1>

<p>A version of the intent passed in the call to GET /editSpecs, possibly modified to meet rules set by
the tenant. For example:
<ul>
<li>candidate applying for pilot reqs must also register their interest in pilot jobs
<li>candidates applying to some specific customer service req must first apply to the pipeline req
<li>candidates apply to any req must agree to receive email
<li>candidates cannot apply to call centre reqs unless they have already been starred as 3 or greater in the call centre talent pool
</ul>

<h1>inputModel</h1>

<p>The inputModel defines the data (e.g. resume, personal details, attached documents, data items)
that the candidate may or must provide in order to complete the edit, possibly also considering the device
they are using.
</p>

<h1>itemsRule</h1>

<p>The individual data items that the candidate must supply, either candidate-scoped or application-scoped, e.g.:
<ul>
<li>if the amended profile includes applying for a job based in Australia, candidate may be asked "what is your eligibility to work in Australia?"
<li>if the amended profile includes registering interest in financial advisor jobs in NZ, candidate might need to upload an industry certification.
<li>if the device is smartphone, then a reduced set of questions may be asked
<li>if the profile includes applying for a job, and the candidate is internal, they may be asked "have you checked with your manager?"
<li>if the profile includes applying for a job, and the candidate has already been pre-vetted (e.g. employee referral perhaps in-store)
then they may get a truncated application form
</ul>
</p>

<p>The itemsRule is an extension variant of <a href='http://json-schema.org/'>json schema</a>. The extensions are described below.
</p>

<h2>propertyOrder</h2>

<p>Individual properties can have a propertyOrder property, which acts as per as per https://github.com/jdorn/json-editor#property-ordering.
This can be used to control their display order <b>within their enclosing object</b>, e.g.:
<div class='codeBlock'>
"firstName": {
   "type": "string",
   "access": "candidateOwned",
   "propertyOrder": 1001
}
</div>
</p>

<h2>access</h2>

<p>Individual properties must have an access property, which can take any of these values:
<ul>
<li>candidateOwned
<li>internalOwned
<li>internalShared
<li>eeo
</ul>



<h2>Special formats for type=object</h2>

<p>itemsRules can use a set of formats on properties of type "object". These formats are also sometimes further controlled
by an options property that provides hints as to behaviour. For example the tas-fileUpload format allows an option of "accept"
that describes the allowable file formats as a comma separated list of mime types.
</p>

<h3>tas-enumdetails</h3>

<p>Used to handle situations such as yes/no/details.
</p>

<h3>tas-fileupload</h3>

<p>Used for file uploads. Should be applied to an object that has data, fileName and via properties.</p>

<p>An option of "accept" can be used to describe the allowable file formats as a comma separated list of mime types.

<div class='codeBlock'>
{
    "coverLetter": {
        "type": "object",
        "format": "tas",
        "access": "candidateOwned",
        "options": {
            "type]": "fileUpload",
            "accept": "image/png,text/html"
        },
        "description": "Please upload a cover letter. The shorter the better",
        "properties": {
            "data": {
                "type": "string",
                "media": {
                    "binaryEncoding": "base64"
                }
            },
            "fileName": {
                "type": "string"
            },
            "via": {
                "type": "string"
            }
        }
    }
}</div>
</p>

<h2>Arrays</h2>

<p>The itemsRule section can include arrays (i.e. table questions, such as "which of the following do you have experience in?"). For array to be
valid, we require that:
<ul>
<li>Tuple typing must not be used
<li>Arrays are not nested (only one level of arrays)
<li>In the schema for the array items:
<ul>
<li>Array items must be of object type
<li>one and only one property within the array item must have the extension "primaryKey" value set to true
<li>that property must be required
<li>the special property "itemOp" must be present
<li>it must be an enum of ["add", "replace", "remove"]
<li>it must be required
</ul>
</ul>


<h1>candidateEdit</h1>

<h2>items</h2>

<p>This section describes the items section of the request for POST /candidates.
The items section is json containing one or more values that should be used to update the candidate's data.
</p>

<h3>Handling incoming items (producing POST /candidates)</h3>

<h4>Re-fetch the editSpec</h4>

<p>To process the incoming items, the producer of POST /candidates first must fetch an edit spec. The result will
likely be the same edit spec the consumer fetched earlier to build the UI that the candidate used to enter the
items (e.g., the application form to apply for a job).
</p>

<p>Every item in the incoming items section should have a matching entry in the editSpec's itemsRule section. If an incoming
item does not have a matching entry in the edit spec, this could indicate a malicious app trying to write to
an item it does not have access to, and the edit should be failed.
</p>

<h4>Strip out object structure</h4>

<p>Any object structure in the incoming items is remove. So this..
<div class='codeBlock'>
{
    "Eligibility": {
        "Years in industry": 28.2,
        "Able to lift heavy objects": true
    },
    "Availability": {
        "Shift details": {
            "Shift work": "Yes, any hours"
        }
    }
}
</div>

<p>..is translated to this..
<div class='codeBlock'>
{
    "Years in industry": 28.2,
    "Able to lift heavy objects": true,
    "Shift work": "Yes, any hours"
}
</div>
<p>

<h4>Preserve object structure for format=tas objects</h4>

<p>An exception to the above is when the edit spec shows format=tas for an object. In that case, the object 
represents a single item, but one that has multiple fields. e.g. If items is like this..
<div class='codeBlock'>
{
    "Eligibility": {
        "Years in industry": 28.2,
        "Able to lift heavy objects": true
    },
    "Availability": {
        "Shift details": {
            "Shift work": "Yes, any hours"
        }
    },
    "coverLetter": {
       "data": "iu7g6xswqs6216Ug564fojho7if8dfi876GKJH..",
       "fileName": "coverletter.docx",
       "via": "dropbox.com"
}
</div>
</p>

<p>
.. and the matching entry for cover letter in itemsRule is like this..
<div class='codeBlock'>
{
    "type": "object",
    "format": "tas",
    "options": {
        "type": "fileUpload",
        "accept": "image/png,text/html"
    },
    "description": "Please upload a cover letter. The shorter the better",
    "properties": {
        "data": {
            "type": "string",
            "media": {
                "binaryEncoding": "base64"
            }
        },
        "fileName": {
            "type": "string"
        },
        "via": {
            "type": "string"
        }
    }
}
</div>
</p>

<p>Then after processing there will be 3 items to process, one of which is multi-valued:
<div class='codeBlock'>
{
    "Years in industry": 28.2,
    "Able to lift heavy objects": true,
    "Shift work": "Yes, any hours",
    "coverLetter": {
        "data": "iu7g6xswqs6216Ug564fojho7if8dfi876GKJH..",
        "fileName": "coverletter.docx",
        "via": "dropbox.com"
    }
}
</div>
</p>

<h4>Arrays</h4>

<p>The items section can contain arrays, e.g.:
<div class='codeBlock'>
{
    "specific experience": [
        {
            "type": "Food handling",
            "years": 1.5
        },
        {
            "type": "Cash handling",
            "years": 1
        }
    ]
}
</div>
</p>

<p>For the items section to be valid, we require that:
<ul>
<li>In the items, when the property "itemOp" has a value of "add", the value for the primary key property must be null (since primary keys are
generated by the server).
</ul>

<h3>tas-enumdetails</h3>

<p>TBD</p>

<h3>tas-fileupload</h3>

<p>
<div class='codeBlock'>
{
    "coverLetter": {
       "data": "iu7g6xswqs6216Ug564fojho7if8dfi876GKJH..",
       "fileName": "coverletter.docx",
       "via": "dropbox.com"
}
</div>
</p>

<h2>resume</h2>

<p>If a resume element is passed then any existing resume will be replaced by the contents of the resume element. If null, the existing
resume will be removed.

<p>Producer must run file through OWASP security tests.
</p>

<p>
<div class='codeBlock'>
{
    "resume": {
       "data": "iu7g6xswqs6216Ug564fojho7if8dfi876GKJH..",
       "fileName": "mycv.docx",
       "via": "device"
}
</div>
</p>

<h2>Applications</h2>

<p>Producer should check that the jobs for any applications are active. No check is needed of
the "open to internal" rules on the js vs. the candidate's actual type. That sort of excess
validation gets in the way of sending special candidate direct links for them to apply (e.g.
after an opening has closed, or to allow a special external applicant through to an internal-only opening).
</p>



<script>
$(document).ready(function() {

	renderSequenceDiagrams();
	renderClientIncludes();
	renderTOC();
});
</script>


</body>
</html>