<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

	<title>Job board hub, category mapping app and job board apps</title>

    <!-- Bootstrap core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../css/simple-sidebar.css" rel="stylesheet">

<!-- for sequence diagrams -->
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/raphael-min.js'></script>
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/underscore-min.js'></script>
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/sequence-diagram-min.js'></script>
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/sequence-diagram-wrapper.js'></script>

<!-- for includes -->
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/clientInclude.js'></script>

<!-- for table of contents -->
<script type="text/javascript" src='http://talentappstore.github.io/tas-des-static/js/tocify.js'></script>

<!--  manage the versions dropdown, always using the very latest -->
<script type="text/javascript" src='http://devdocs.talentappstore.com/versions.js'></script>

<style>
span.highlight {
background-color: #ffff99;
padding: 6px;
border: dashed #ff6666 1px;
}
td.uncommon {
background-color: #cccccc;
}
small.hint {
color: #666666;
}
</style>


</head>
<body>
    <div id="wrapper" class="toggled">

<p><b>SIDEBARGOESHERE</b></p>

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
                <a href="#menu-toggle" class="btn btn-secondary" id="menu-toggle">Toggle document index</a>
                <br /><br />

<div id="toc">
</div>



<h1>What each app does</h1>


<h2>The board</h2>

<p>The board does everything that only the board can do. Anything that is common to many boards should be in the hub instead, so that individual
job board apps remain as simple as possible.
</p>


<h3>Producing GET /appStatus (optional)</h3>

<p>This step is optional. The board might never need any setup.
</p>

<p>If the board is in a setup error state (e.g. missing advertiser id, credentials) then its setup error message, held in the hub, will be non-null.
</p>

<p>This could have happened by:
<ul>
<li>the board previously detecting bad credentials while calling its own upload APIs, and setting the setup error message via
<a href='../generated/recruitment.raml.html#jobBoards_forApp_status_patch'>PATCH /jobBoards/forApp/status</a>.
<li>The setup error message being set by default for new installs (since the board knows that setup is always required).
</ul>

<p>So the board should first fetch its own setup error state by calling
<a href='../generated/recruitment.raml.html#jobBoards_forApp_status_get'>GET /jobBoards/forApp/status</a>.
</p> 
   
<p>Then, if the board is in a setup error state, it can cause the setup required icon to appear on the app via its response to
<a href='../generated/recruitment.raml.html#appStatus_get'>GET /appStatus</a>.
</p> 


<h3>Producing a setup page (optional)</h3>

<p>This step is optional. The board might be able to start working with no additional information.
</p>

<p>The board should call <a href='../generated/recruitment.raml.html#jobBoards_forApp_status_get'>GET /jobBoards/forApp/status</a> to fetch its setup error message
(e.g "credentials have been denied") and display that at the top of the setup page so the admin user knows what needs to be fixed before the board
can start working. 
</p> 

<p>On the setup page should be fields for any required information, e.g. API tokens, advertiser codes, etc.
</p>

<p>Once complete, the settings page should update the board's status to say things are good to go by calling
<a href='../generated/recruitment.raml.html#jobBoards_forApp_status_patch'>PATCH /jobBoards/forApp/status</a>
and nulling out the setup error message.
</p>


<h3>Publishing board's details</h3>

<p>This step is mandatory.</p>

<p>The board must produce <a href='../generated/recruitment.raml.html#jobBoards_forApp_get'>GET /jobBoards/forApp</a>
so that the hub can fetch its details.
</p>

<p>This includes:
<ul>
<li>job board name
<li>domain (e.g. www.jobboard.com - used to create trackers)
<li>default ad duration (how long do ads remain up on the site, e.g. 30d)
<li>common fields list (list of the common fields that the board can use, e.g. ["recruiter email", "recruiter name"])
<li>default legacy source code (e.g. source=BIGJOBS)
<li>a default value for the installed board's setup error message. If not null, setup required will light up on the app for all new installs.  
</ul>


<h3>Publishing board's categories and their values</h3>

<p>This step is optional. A board may have no categories at all.</p>


<p>If the job board categorises its jobs by e.g. location, classification/expertise etc. then it
must publish these categories by producing <a href='../generated/recruitment.raml.html#jobBoards_forApp_categories_get'>GET /jobBoards/forApp/categories</a>
and
<a href='../generated/recruitment.raml.html#jobBoards_forApp_categories_byID__category__values_get'>GET /jobBoards/forApp/categories/byID/{category}/values</a>.
</p>

<p>These APIs are called by the hub and the category mapper apps.
</p>



<h3>Synchronising posting objects into the board's back end in real time</h3>

<p>This step is mandatory.</p>

<p>The board must produce
<a href='http://localhost:8080/tasgit/tas-tenant-apis/docs/generated/recruitment.raml.html#postings_byID__id__tenantDeltaPings_post'>POST /postings/byID/{id}/tenantDeltaPings</a>
so to be alerted when its own postings are changed.
</p> 

<p>As postings are created, updated, and opened and closed and deleted in real time in the hub, the board
is responsible for listening for these delta pings and then synchronizing the changes back to its own back end, e.g. via its own Upload APIs.
</p>

<p>How the board does this synchronizing is up to the board. Some boards use bulk upload APIs where the client always sends up all open postings. Others have web
services to modify individual postings. Some might use ftp, csv, etc. The board might do it instantly, or every  hour.
</p>

<p>There are 4 scenarios that will cause a job board app to receive a delta ping alerting of posting activity:  
<ul>

<li>a posting is created by the user via the the user clicking the hub's UI
<li>or edited (e.g. description is changed)   

<li>A posting has been closed (because of job closed or posting closed or posting expired):
<ol>
<li>close date has been set (is non null)
<li>status == closed
<li>status message == e.g. Expired  
</ol>

<li>A posting has been re-opened:
<ol>
<li>close date has been set to null
<li>status now == open 
</ol>
</ul>


<h3>Producing a web page to capture board-specific fields (optional)</h3>

<p>This step is optional. A board may only use common data.</p>

<p>The job board hub provides the posting form to capture the fields that are common to most or all
job boards (job title, reference, description, categories, scheduled close date). So the board does not need any UI to capture these.
</p>

<p>However if the board has any special fields (such as an advertiser template, or a video) on its postings,
then the board can cause a web page to be injected into the posting form by producing
<a href='http://localhost:8080/tasgit/tas-tenant-apis/docs/generated/recruitment.raml.html#jobBoards_forApp_postingUI_byID__posting__get'>GET /jobBoards/forApp/postingUI/byID/{posting}</a>.

The web page's javascript must pack the captured board-specific fields into a json document.
</p>


<h3>Adding board-specific fields admin (optional)</h3>

<p>This step is optional. Some boards won't have any board-specific fields.</p>

<p>The job board app must provide all functionality for its own unique posting data fields. For example to implement templates, the board needs a database to store them,
UI to upload them, and then more UI inside the wizard page so that the user can select them when they create a posting.
</p>


<h3>Synchronising after sleep (optional)</h3>

<p>This step is optional. A highly available board may rely on always capturing delta pings.</p>

<p>When the job board app starts up after maintenance, it should pull all of its own open postings from the hub,
and use that to call its own upload APIs to synchronise its back end.
</p>

<p>This will handle for any activity (new postings, expired postings) that may have happened on the hub while the app was asleep.
</p>


<h3>Synchronising of preview link (optional)</h3>

<p>This step is optional. Some boards won't provide a preview link.</p>

<p>Some boards will be able to provide a preview link where the recruiter can see the job on the board itself.
</p>

<p>When a preview link is available, e.g. when the board's upload APIs are called, the board
can update the posting within the hub by calling
<a href='../generated/recruitment.raml.html#postings_byID__id__appDetails_patch'>PATCH /postings/byID/{id}/appDetails</a>.
</p>

<h3>Report stale credentials (optional)</h3>

<p>This step is optional.</p>

<p>The tenant's board specific details (keys, advertiser codes etc.) may become invalid.
</p>

<p>Once this happens the job board app will start seeing errors as it makes API calls in to the board's back end.
</p>

<p>To signal this to the tenant, the job board app can call
<a href='../generated/recruitment.raml.html#jobBoards_forApp_status_patch'>PATCH /jobBoards/forApp/status</a>
to update the installed board's setup error message (held inside the hub).
</p>

<p>The board can then light up the "setup required" icon on the app, and on the setup page get the credentials.
</p>

<p>Once the credentials are OK the board can clear the setup error message, which will allow the hub to start using it again.
</p> 

<h2>The hub</h2>

<p>The hub handles as much as possible, so that job board apps are as thin as possible. Any functionality that is common to all or many job boards
is in the hub.
</p>

  
<h3>Handling installs</h3>

<p>When the hub is installed, it checks for existing installed job board apps and updates its installed boards table.
</p>

<h3>Showing the settings page</h3>

<p>The hub's settings page lets the admin user control the legacy source code field for each installed board.
</p>


<p>The field defaults to defaultLegacySourceCode as passed by the board via
<a href='http://devdocs.talentappstore.com/generated/recruitment.raml.html#jobBoards_forApp_get'>GET /jobBoards/forApp</a>.
</p>

<p>When legacy source code is set against a board, all linkouts for postings on that board will have a "source=" parameter appended with that value.
</p> 

<p>Some ATS's will be able to use the information in the tracker for sourcing purposes and won't need this field set.
</p>

<h3>Showing the job panel</h3>

<p>The hub injects a panel for creating and updating postings into the job page in the ATS.
</p>

<p>This shows a list of the existing postings for the job, across all boards, including:
<ul>
<li>the board's icon (shrunk)
<li>the posting title (truncated)
<li>the status message (listing expired, job closed, etc.)
<li>menu/links to:  

<ul>
<li>Repost (re-open)
<li>Edit (shows the posting wizard again)
<li>Expire (close)
</ul>

</ul>

<p>The panel also allows creating new postings by clicking a board's icon. The user then is redirected
to the posting form in a full window.
</p>
 

<h3>Showing the posting form</h3> 

<p>The posting wizard is a web page served by the hub to capture the user data (job title, categories etc.) for a posting.
</p>

<p>In the top of the posting form, the hub captures common fields (title, reference, description and category values).
</p>

<p>The hub can also inject an iframe-ed page hosted by the job board app at the bottom that captures board-specific fields
(e.g. template, advertiser profile, cost center, video, headline, bullets, etc.)
</p>

<ol>
<li>To decide which common fields to display, the hub asks the board for it's settings
<li>To populate the category fields, the hub asks the job board for its categories
<li>To set defaults for the categories, the hub calls the category mapping API
<li>In the scheduled close date field, recruiter sees today + 30, though underneath the field is null
<li>The recruiter could also set scheduled close date to a value, e.g. so the posting is only open for 10 days. Or to a year in the future, in
which case the posting would remain active for a year, being re-billed every 30 days. 
<li>Once the user has ok-ed the form, the hub:
<ol>
<li>creates a posting object in its own database. The posting object holds all the data needed to post the job, including:
<ul>
<li>the common fields (title, description, etc.)
<li>the board-specific fields (held as a json document)
</ol> 
</ul>
<li>sends a "new posting" delta ping to the relevant job board app.
</ol>
</ol>


<div class='seqDiag' id="seq1">

note right of poster: poster grabs common details:
note right of poster: get title, description
poster->ats: GET /jobs/byID/{}

note right of poster: get category drop down values
poster->board: GET /jobBoards/forApp/categories
poster->board: GET /jobBoards/forApp/categories/byID/{}
poster->board: GET /jobBoards/forApp/categories/byID/{}/values

note right of poster: get mappings (to set defaults)
poster->mapper: POST /jobBoards/forApp/{app}/mappings 

note right of poster: poster pops UI so user can\nedit title, description, categories
note right of poster: get link to board's\niframe-ed custom fields UI (if any)
poster->board: GET /jobBoards/forApp/postingUI/byID/{posting}

note right of poster: Custom fields UI is shown.\n User edits, clicks OK. postMessage\npasses custom fields as json to hub.\nHub updates posting.

note right of poster: poster signals that the posting\nhas changed
poster->board: POST /jobBoards/postings/byID/{}/tenantDeltaPings

</div>



<h3>Handling expire, reopen requests</h3>

<p>The panel allows the user to click to expire or reopen postings.
</p>

<p>The hub responds by:
<ol>
<li>Updating the posting object (actual close date, close date, status, last updated by email and date)
<li>sending a delta ping to the relevant job board app.
<li>displaying ajax spinning widget in the panel throughout
</ol> 
 

<h3>Building linkout urls, including modern (tracker) and legacy source tracking</h3>

<p>For the posting, the hub builds the linkout url leading to the job on the careers site, including source tracking
information.
</p>

<p>The hub builds this by:
<ol>
<li>Call GET/BLAH to ask the primary career site for a link to the job
<li>Calling POST /trackers to create a campaign tracker and appending it to the linkout url
</ol>

<p>If the installed board has its legacy source code set, then the linkout url should have "&source= appended to it." 
 

<h3>Processing postings that have expired</h3>

<p>A dameon finds all postings that have arrived at their scheduled close date.
</p>

<p>The daemon:
<ol>
<li>sets status = closed
<li>sets actual close date = sysdate
<li>sends delta ping to relevant job board app
</ol>


<h3>Listening for jobs closing in the ATS</h3>

<p>The hub listens for jobs closing on the ATS. It closes the attached postings and notifies the relevant job board app.
</p>

<p>
<ol>
<li>The hub learns via delta ping that a job has just closed in the ATS
<li>It iterates through all of the postings for that job doing this:
<ol>
<li>set status = closed
<li>set close date = sysdate
<li>set status message = "Job closed"
<li>send delta ping to relevant job board app
</ol>
</ol>
</p>

<h3>Handling tenant reboots</h3>

<p>When the hub starts up after maintenance, or the tenant is rebooted, the hub pulls all
category values from all installed job boards.
</p>

<p>The job board's categories may have changed, making existing postings held in the
hub outdated.
</p>

<p>If any existing open postings are found that are using a category value that no longer exists,
their stale flag is set. This causes the posting to be displayed e.g. in red in the job panel.
</p>

<p>The posting form highlights to the user to which category needs fixing.
</p>

<p>When the user successfully submits the posting form, the stale flag is cleared by the hub. 


<h3>Handling uninstalls</h3>

<p>The hub prevents uninstall (returns 400 to DELETE /tenants/{}) if there are installed boards.
</p>

<p>When a job board app is uninstalled, the hub preserves all data by updating installed boards table:
- prior app shortcode = app shortcode
- app shortcode = null

<p>So the tenant can reinstall the app (or another customer who picks up the same tenant shortcode can install it for the first time) and the
old data won't be visible.
</p>
  
<p>However the old data can be shown (e.g. with strike through) in the hub's screens and in posting statistics etc.  
</p>


<h3>Maintaining audit history</h3>

<p>All changes to postings and installed boards, including who made them and when, are stored in audit tables or otherwise in some persistent store.
</p>

<p>Some UI in the hub provides a UI to see and search posting audit data.
</p>



<h3>More functionality</h3>

<p>More UI can be added to the hub that is useful across all job boards, e.g.:

<ul>
<li>List of recent postings across all jobs and boards
<li>Show postings per user/category
<li>graphs of posting activity
<li>Tools like FreshChat
</ul>



<h3>Hub database</h3>

<h4>Posting objects</h4>
<ul>
<li>housekeeping:
<ul>
<li>id
<li>installed board id
<li>created by email</li>
<li>created by date</li>
<li>last updated by email</li>
<li>last updated by date</li>
<li>status (draft, open, closed) - <b>do we need error?</b>
<li>status message e.g. "listing expired", "job closed", "error - missing blah",  etc.)
<li>scheduled close date
<li>actual close date
<li>stale flag
</ul>
<li>common fields
<ul>
<li>set by user
<ul>
<li>title
<li>description
<li>ref
<li>category values
<li>recruiter name
<li>recruiter email
<li>recruiter team
<li>contact person name
<li>contact person email
<li>application email
<li>linkout url
</ul>
<li>set by board
<ul>
<li>preview link
</ul>

</ul>

<li>board-specific fields
<ul>
<li>custom fields json (e.g. advertiser profile, template, premium features, video)
</ul>

</ul>
</p>

<h4>Installed boards</h4>

<ul>
<li>housekeeping:
<ul>
<li>
<li>id
<li>tenant
<li>app shortcode (set before uninstall)</li>
<li>prior app shortcode (set after uninstall)</li>
<li>legacy source code (when present, causes linkouts for this board to have source=CODE appended to them)</li>
<li>setup error message (e.g. invalid credentials). When non-null:
<ul>
<li>new postings can't be created
<li>the board appears in the hub's UI with warning icons, which links to the app's setup page 
</ul>

</ul>
</ul>


<h4>Audit data</h4>

<p>Database tables/log files/s3 storage of who did what to which postings and when.
</p>



<h2>The category mapper</h2>

<div class='seqDiag' id="seq0">

note right of mapper: user opens app

note right of mapper: mapper enumerates boards

mapper->board: GET /boards/forApp
mapper->board2: GET /boards/forApp

note right of mapper: mapper gets all nodes\nfrom tenant
mapper->board: GET /categories
mapper->board: GET /categories/byID/{}
mapper->board: GET /categories/byID/{}/values

note right of mapper: user starts mapping\nfor first board

note right of mapper: mapper gets all nodes from board
mapper->board: GET /jobBoards/forApp/categories
mapper->board: GET /jobBoards/forApp/categories/byID/{}
mapper->board: GET /jobBoards/forApp/categories/byID/{}/values

note right of mapper: user maps categories

note right of mapper: user maps nodes

</div>


            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->

    <!-- Bootstrap core JavaScript -->
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {

	renderSequenceDiagrams();
	renderClientIncludes();
	renderTOC();

	// needs to come after renderTOC
	detectVersion();
	$("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
});
</script>
</body>
</html>
